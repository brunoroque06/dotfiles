#!/usr/bin/env bash

set -e

install() {
	./brew/setup

	SH=/opt/homebrew/bin/bash
	grep -qxF $SH /etc/shells || echo $SH | sudo tee -a /etc/shells
	chsh -s $SH

	echo "export PATH=/opt/homebrew/bin:$PATH" >~/.bash_profile

	defaults write -g ApplePressAndHoldEnabled -bool true
}

paths=(
	"$HOME/.config/elvish" elvish
	"$HOME/.config/fish" fish
	"$HOME" git
	"$HOME" jetbrains
	"$HOME/.config/nvim" neovim
	"$HOME/Library/Application Support/nushell" nushell
	"$HOME" postgresql
	"$HOME/.config" ripgrep
	"$HOME/Library/Application Support/Code/User" vscode
)

link() {
	mkdir -p "$1"
	stow -S -v 1 -t "$1" "$2"
}

unlink() {
	stow -D -v 1 -t "$1" "$2"
}

link_manager() {
	for ((i = 0; i < ${#paths[@]}; i += 2)); do
		$1 "${paths[i]}" "${paths[i + 1]}"
	done
}

case "$1" in
install)
	install
	;;
link)
	link_manager link
	;;
unlink)
	link_manager unlink
	;;
*)
	printf 'Available Commands:\n\ninstall\nlink\nunlink\n'
	;;
esac
